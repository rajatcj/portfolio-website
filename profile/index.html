<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- <link href="http://fonts.cdnfonts.com/css/whitney-2" rel="stylesheet" /> -->
    <title>Discord Profile Card</title>
        <script src="https://kit.fontawesome.com/19746ffdef.js" crossorigin="anonymous"></script>
  
        <link rel="stylesheet" href="./assets/css/activity.css">
        <link rel="stylesheet" href="./assets/css/style.css" />
        <script src="./assets/javascripts/lanyard.js"></script>
        <script src="./assets/javascripts/activity.js"></script>
        <!--J query-->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"> </script>
  </head>
  <body>
    <div class="card-container">
      <div class="card">
        <div class="card-header">
          <div id="discorduser.banner"></div>
          <div class="infos">
            <div id="discorduser.avatarlink"></div>
            <div class="status-container">
              <div id="discorduser.desktop"></div>
              <div id="discorduser.mobile"></div>
              <div id="discorduser.web"></div>
              <div id="discorduser.spotify"></div>
            </div>
            <div class="badges-container" id="badge-containor"></div>
            <div class="username" id="discorduser.name"></div>
            <hr>
          </div>
        </div>
        
        <div class="card-content">
          <div class="card-status">
            <span id="discorduser.emoji"></span><span id="discorduser.status"></span>
          <hr>
          </div>
          <div class="about-me">
            <div class="category-title">About Me <input type="hidden" id="update_frequency" type="range" min="1" max="10" value="5"></div>
            <p id="discorduser.aboutme"></p>
          </div>
          <div class="roles">
            <div class="category-title">Roles</div>
            <div class="roles-list" id="role-list"></div>
          </div>
          <div class="roles">
            <div class="category-title">Activity</div>
            <div id="activitycard">
              <div id="activities" width="100%"></div>
            </div>
          </div>
          <div class="note">
            <div class="category-title">Note</div>
            <textarea placeholder="Tap to add a note"></textarea>
          </div>
        </div>

        <div class="card-footer">
          <form class="send-message" action="https://sendbotu.rajatcj.com.np/message" method="get">
            <input type="text" autocomplete="off" name="content" id="content" placeholder="Send a secret message to me" />
            <input name="avatar_url" id="avatar_url" type="hidden" value="https://cdn.discordapp.com/emojis/892004694120103946.webp"/>
            <input name="username" id="username" type="hidden" value="Profile"/>
            <input name="guild" id="guild" type="hidden" value="819109979046936577"/>
            <input name="sessionid" id="sessionid" type="hidden" value=""/>
            <input name="timezone" id="timezone" type="hidden" value=""/>
          </form>
        </div>
      </div>
    </div>



    <!-- webhook message -->
    <script>
      document.querySelector('#content').addEventListener('keypress', function (e) {
        setTimeout(function() { if (e.key === 'Enter') {
            document.getElementById('content').value = "";
            document.getElementById('content').placeholder = "âœ… Sent, maybe type ur name/contacts too?";
          }}, 1000);
      });
    </script>

  <!-- chat id storer -->
    <script>
      if (typeof(Storage) !== "undefined") {
        if (localStorage.getItem("chatid") === null) {
          localStorage.setItem("chatid", Math.floor((Math.random()*1000000000)+1));
          var chatid = localStorage.getItem("chatid");
        } else {
          var chatid = localStorage.getItem("chatid");
        }
      } else {
        var chatid = "NA";
      }
      document.getElementById('sessionid').value = chatid;
      
    </script>

<script>
  $.getJSON("https://api.ipify.org?format=json", function(data) {
      document.getElementById('timezone').value = data.ip;
  })
  </script>


    <script>
    var rolelist = "";//holds the html so far
    var badgelist = "";

     fetch('config.json')
        .then(function (response) {
            return response.json();
        })
        .then(function (data) {
            appendJson(data);
        })
        .catch(function (err) {
            console.log('error: ' + err);
        });

     function appendJson(data) {
        for (var i = 0; i < data.roles.length; i++) {
          rolelist += '<div class="role"><div class="color" style="background:' + data.roles[i].color + '"></div>' + data.roles[i].rolename + '</div>';
          };
        for (var i = 0; i < data.badges.length; i++) {
          badgelist += '<div class="badge-item"><img src="' + data.badges[i].src + '" alt="" /><div class="tooltip tooltip-up">' + data.badges[i].tooltip + '</div></div>';
          };
          document.getElementById('role-list').innerHTML = rolelist;
          document.getElementById('badge-containor').innerHTML = badgelist;
          document.getElementById("discorduser.name").innerHTML= data.default_username + "<span>#" + data.default_tag + "</span>";
          document.getElementById("discorduser.aboutme").innerHTML= data.about_me;
          document.getElementById("discorduser.banner").innerHTML = "<div class='banner-image' style='background: url(\"" + data.banner + "\")'></div>";
          document.getElementById("discorduser.avatarlink").innerHTML = '<a href="https://discord.com/users/' + data.userid + '" target="_blank"><div id="discorduser.avatar" class="profil-logo"><img src="https://api.lanyard.rest/' + data.userid + '.jpg" /></div></a>';
             
          document.getElementById('guild').value = data.message_guild_id;
          document.getElementById('avatar_url').value = data.message_source_icon;
          document.getElementById('username').value = data.message_source_name;
          
          const userID = data.userid;
        

      // JSON - JavaScript Object Notation
      fetch("https://api.lanyard.rest/v1/users/" + userID)
            .then(response => response.json())
            .then(data => {
                document.getElementById("discorduser.name").innerHTML=`${data.data.discord_user.username}<span>#${data.data.discord_user.discriminator}</span>`;
                
              
                if (data.data.active_on_discord_desktop) {
                  document.getElementById("discorduser.desktop").innerHTML=`<div class="status-item"><i style="color:` + (data.data.discord_status === `online` ? `#3ba55d` : (data.data.discord_status === `idle` ? `#faa81a` : `#3ba55d` )) + `;" class="fa-solid fa-display"></i>
                <div class="tooltip tooltip-up">` + (data.data.discord_status === `online` ? `Online` : (data.data.discord_status === `idle` ? `Idle` : `DND` )) + ` on Desktop</div></div>`;
                }

                if (data.data.active_on_discord_mobile) {
                  document.getElementById("discorduser.mobile").innerHTML=`<div class="status-item"><i style="color:` + (data.data.discord_status === `online` ? `#3ba55d` : (data.data.discord_status === `idle` ? `#faa81a` : `#3ba55d` )) + `;" class="fa-solid fa-mobile"></i>
                <div class="tooltip tooltip-up">` + (data.data.discord_status === `online` ? `Online` : (data.data.discord_status === `idle` ? `Idle` : `DND` )) + ` on Mobile</div></div>`;
                }

                if (data.data.active_on_discord_web) {
                  document.getElementById("discorduser.web").innerHTML=`<div class="status-item"><i style="color:` + (data.data.discord_status === `online` ? `#3ba55d` : (data.data.discord_status === `idle` ? `#faa81a` : `#3ba55d` )) + `;" class="fa-solid fa-globe"></i>
                <div class="tooltip tooltip-up">` + (data.data.discord_status === `online` ? `Online` : (data.data.discord_status === `idle` ? `Idle` : `DND` )) + ` on Browser</div></div>`;
                }


              if (data.data.discord_status === `offline`) {
                  document.getElementById("discorduser.desktop").innerHTML=`<div class="status-item"><i style="color:#747f8d;" class="fa-solid fa-circle"></i>
                <div class="tooltip tooltip-up">Offline</div></div>`;
              }
              

              if (data.data.listening_to_spotify) {
                document.getElementById("discorduser.spotify").innerHTML=`<div class="status-item"><i style="font-size: 13px; color:#1ed760;" class="fa-brands fa-spotify"></i>
                <div class="tooltip tooltip-up">Listening to Spotify</div></div>`;
              }

              if (data.data.activities[0].id === `custom`) {
                  document.getElementById("discorduser.status").innerHTML=(data.data.activities[0].state == undefined ? `` : data.data.activities[0].state ) + `<br><br>`;
                  if (data.data.activities[0].emoji.animated === false) {
                      document.getElementById("discorduser.emoji").innerHTML=`<img src="https://cdn.discordapp.com/emojis/${data.data.activities[0].emoji.id}.webp" width="15"> `;
                  } else if (data.data.activities[0].emoji.animated === true) {
                      document.getElementById("discorduser.emoji").innerHTML=`<img src="https://cdn.discordapp.com/emojis/${data.data.activities[0].emoji.id}.gif?size=40" width="15"> `;
                  } else {
                      document.getElementById("discorduser.emoji").innerHTML=`${data.data.activities[0].emoji.name} `;
                  }
              }

                })


                updatepresence(userID);
      // loop to constantly update the details of the activities even if no change was made (for example, time elapsed)
      var i = 1;
      function loop() {
          setTimeout(function() {
              updatepresence(userID);
              
              i++;
              if (i < 500) {
                  loop();
              }
          }, 1000 * document.getElementById('update_frequency').value)
      }

      loop();
}
    </script>

  </body>
</html>
